

Below are the solutions to <a href="http://r-exercises.com/2017/12/27/exercises-with-raster-data-parts-1-2/">these</a> exercises on TOPIC.


<div class="chunk" id="unnamed-chunk-1"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl com">####################</span>
<span class="hl com">#                  #</span>
<span class="hl com">#    Exercise 1    #</span>
<span class="hl com">#                  #</span>
<span class="hl com">####################</span>

<span class="hl kwd">library</span><span class="hl std">(raster)</span>

<span class="hl com">## Create a folder named data-raw inside the working directory to place downloaded data</span>
<span class="hl kwa">if</span><span class="hl std">(</span><span class="hl opt">!</span><span class="hl kwd">dir.exists</span><span class="hl std">(</span><span class="hl str">&quot;./data-raw&quot;</span><span class="hl std">))</span> <span class="hl kwd">dir.create</span><span class="hl std">(</span><span class="hl str">&quot;./data-raw&quot;</span><span class="hl std">)</span>

<span class="hl com">## If you run into download problems try changing: method = &quot;wget&quot;</span>
<span class="hl kwd">download.file</span><span class="hl std">(</span><span class="hl str">&quot;https://raw.githubusercontent.com/joaofgoncalves/R_exercises_raster_tutorial/master/data/srtm_pnpg.zip&quot;</span><span class="hl std">,</span>
              <span class="hl str">&quot;./data-raw/srtm_pnpg.zip&quot;</span><span class="hl std">,</span> <span class="hl kwc">method</span> <span class="hl std">=</span> <span class="hl str">&quot;auto&quot;</span><span class="hl std">)</span>

<span class="hl com">## Uncompress the zip file</span>
<span class="hl kwd">unzip</span><span class="hl std">(</span><span class="hl str">&quot;./data-raw/srtm_pnpg.zip&quot;</span><span class="hl std">,</span> <span class="hl kwc">exdir</span> <span class="hl std">=</span> <span class="hl str">&quot;./data-raw&quot;</span><span class="hl std">)</span>

<span class="hl std">rst</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">raster</span><span class="hl std">(</span><span class="hl str">&quot;./data-raw/srtm_pnpg.tif&quot;</span><span class="hl std">)</span>

<span class="hl com"># Number of rows, columns and layers</span>
<span class="hl kwd">dim</span><span class="hl std">(rst)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 579 555   1
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># Number of rows</span>
<span class="hl kwd">nrow</span><span class="hl std">(rst)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 579
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># Number of columns</span>
<span class="hl kwd">ncol</span><span class="hl std">(rst)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 555
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># Number of layers</span>
<span class="hl kwd">nlayers</span><span class="hl std">(rst)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 1
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># Number of cells</span>
<span class="hl kwd">ncell</span><span class="hl std">(rst)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 321345
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">####################</span>
<span class="hl com">#                  #</span>
<span class="hl com">#    Exercise 2    #</span>
<span class="hl com">#                  #</span>
<span class="hl com">####################</span>

<span class="hl com"># Spatial resolution (pixel size in x and y dimensions)</span>
<span class="hl kwd">res</span><span class="hl std">(rst)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 80 80
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># Coordinate reference system: Datum/Ellipsoid: WGS 1984, Projection: UTM 29N, Units: meters</span>
<span class="hl kwd">crs</span><span class="hl std">(rst)</span>
</pre></div>
<div class="output"><pre class="knitr r">## CRS arguments:
##  +proj=utm +zone=29 +datum=WGS84 +units=m +no_defs +ellps=WGS84
## +towgs84=0,0,0
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">####################</span>
<span class="hl com">#                  #</span>
<span class="hl com">#    Exercise 3    #</span>
<span class="hl com">#                  #</span>
<span class="hl com">####################</span>

<span class="hl com"># The extent object</span>
<span class="hl kwd">extent</span><span class="hl std">(rst)</span>
</pre></div>
<div class="output"><pre class="knitr r">## class       : Extent 
## xmin        : 549619.7 
## xmax        : 594019.7 
## ymin        : 4613377 
## ymax        : 4659697
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># Lenght in meters</span>
<span class="hl kwd">xmax</span><span class="hl std">(rst)</span> <span class="hl opt">-</span> <span class="hl kwd">xmin</span><span class="hl std">(rst)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 44400
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># Height in meters</span>
<span class="hl kwd">ymax</span><span class="hl std">(rst)</span> <span class="hl opt">-</span> <span class="hl kwd">ymin</span><span class="hl std">(rst)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 46320
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">####################</span>
<span class="hl com">#                  #</span>
<span class="hl com">#    Exercise 4    #</span>
<span class="hl com">#                  #</span>
<span class="hl com">####################</span>

<span class="hl com"># Mean</span>
<span class="hl kwd">cellStats</span><span class="hl std">(rst, mean)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 747.2759
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># Standard-deviation</span>
<span class="hl kwd">cellStats</span><span class="hl std">(rst, sd)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 311.8615
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">####################</span>
<span class="hl com">#                  #</span>
<span class="hl com">#    Exercise 5    #</span>
<span class="hl com">#                  #</span>
<span class="hl com">####################</span>

<span class="hl com"># Raster quantiles</span>
<span class="hl kwd">cellStats</span><span class="hl std">(rst,</span> <span class="hl kwc">stat</span> <span class="hl std">=</span> <span class="hl kwa">function</span><span class="hl std">(</span><span class="hl kwc">x</span><span class="hl std">,</span> <span class="hl kwc">...</span><span class="hl std">)</span> <span class="hl kwd">quantile</span><span class="hl std">(x,</span> <span class="hl kwc">probs</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0.01</span><span class="hl std">,</span> <span class="hl num">0.25</span><span class="hl std">,</span> <span class="hl num">0.5</span><span class="hl std">,</span> <span class="hl num">0.75</span><span class="hl std">,</span> <span class="hl num">0.99</span><span class="hl std">), ...))</span>
</pre></div>
<div class="output"><pre class="knitr r">##   1%  25%  50%  75%  99% 
##   72  527  774  983 1340
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">####################</span>
<span class="hl com">#                  #</span>
<span class="hl com">#    Exercise 6    #</span>
<span class="hl com">#                  #</span>
<span class="hl com">####################</span>

<span class="hl com"># Get values for the raster (memory may be an issue)</span>
<span class="hl std">x</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">values</span><span class="hl std">(rst)</span>

<span class="hl com"># Make the plot (notice higher deviations for values above the average)</span>
<span class="hl kwd">qqnorm</span><span class="hl std">(x)</span>
<span class="hl kwd">qqline</span><span class="hl std">(x)</span>
</pre></div>
</div><div class="rimage default"><img src="https://raw.githubusercontent.com/joaofgoncalves/R_exercises_raster_tutorial/master/figure/unnamed-chunk-1-1.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl com">####################</span>
<span class="hl com">#                  #</span>
<span class="hl com">#    Exercise 7    #</span>
<span class="hl com">#                  #</span>
<span class="hl com">####################</span>

<span class="hl kwd">set.seed</span><span class="hl std">(</span><span class="hl num">12345</span><span class="hl std">)</span>

<span class="hl com"># Generate random points with uniform distribution bounded by the raster extent</span>
<span class="hl std">xyRandPoints</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">data.frame</span><span class="hl std">(</span><span class="hl kwc">x</span> <span class="hl std">=</span> <span class="hl kwd">runif</span><span class="hl std">(</span><span class="hl num">100</span><span class="hl std">,</span> <span class="hl kwd">xmin</span><span class="hl std">(rst),</span> <span class="hl kwd">xmax</span><span class="hl std">(rst)),</span> <span class="hl kwc">y</span> <span class="hl std">=</span> <span class="hl kwd">runif</span><span class="hl std">(</span><span class="hl num">100</span><span class="hl std">,</span> <span class="hl kwd">ymin</span><span class="hl std">(rst),</span> <span class="hl kwd">ymax</span><span class="hl std">(rst)))</span>

<span class="hl com"># Convert the initial data frame into a SpatialPoints objects for clarity</span>
<span class="hl std">xyRandPoints</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">SpatialPoints</span><span class="hl std">(xyRandPoints,</span> <span class="hl kwc">proj4string</span> <span class="hl std">=</span> <span class="hl kwd">crs</span><span class="hl std">(rst))</span>

<span class="hl com"># Extract values</span>
<span class="hl std">xyVals</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">extract</span><span class="hl std">(rst, xyRandPoints)</span>

<span class="hl kwd">print</span><span class="hl std">(xyVals)</span>
</pre></div>
<div class="output"><pre class="knitr r">##   [1] 1217  820  934  825  317  302  669 1101 1028  899  661  206  689  184
##  [15] 1114  975  874  782  319  906  538  623 1079  560  578 1116  999 1229
##  [29]  456 1039  710  397 1104  531 1183  938  942  971  610  627 1190  721
##  [43] 1057  695  320  924   45  135  143 1139  628  975 1184  332  888  977
##  [57]  548  269  988 1012  540  884  612  781 1185  348  851  488 1159 1037
##  [71] 1021 1029 1112 1102  113  874  883 1157 1118  728 1038  760  484  379
##  [85]  215 1112  788 1150  817  719 1009  788  186 1198 1000  619 1109  766
##  [99]  433  566
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">####################</span>
<span class="hl com">#                  #</span>
<span class="hl com">#    Exercise 8    #</span>
<span class="hl com">#                  #</span>
<span class="hl com">####################</span>

<span class="hl std">rstFt</span> <span class="hl kwb">&lt;-</span> <span class="hl std">rst</span> <span class="hl opt">/</span> <span class="hl num">0.3048</span>

<span class="hl std">rstStack</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">stack</span><span class="hl std">(rst, rstFt)</span>

<span class="hl kwd">print</span><span class="hl std">(rstStack)</span>
</pre></div>
<div class="output"><pre class="knitr r">## class       : RasterStack 
## dimensions  : 579, 555, 321345, 2  (nrow, ncol, ncell, nlayers)
## resolution  : 80, 80  (x, y)
## extent      : 549619.7, 594019.7, 4613377, 4659697  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=utm +zone=29 +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0 
## names       : srtm_pnpg.1, srtm_pnpg.2 
## min values  :     9.00000,    29.52756 
## max values  :    1520.000,    4986.877
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">####################</span>
<span class="hl com">#                  #</span>
<span class="hl com">#    Exercise 9    #</span>
<span class="hl com">#                  #</span>
<span class="hl com">####################</span>

<span class="hl com"># Bounding coordinates</span>
<span class="hl std">xmin</span> <span class="hl kwb">&lt;-</span> <span class="hl num">554615</span>
<span class="hl std">xmax</span> <span class="hl kwb">&lt;-</span> <span class="hl num">589015</span>
<span class="hl std">ymin</span> <span class="hl kwb">&lt;-</span> <span class="hl num">4618355</span>
<span class="hl std">ymax</span> <span class="hl kwb">&lt;-</span> <span class="hl num">4654705</span>

<span class="hl com"># Create the extent object by defining the bounding coordinates</span>
<span class="hl std">newExtent</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">extent</span><span class="hl std">(xmin, xmax, ymin, ymax)</span>

<span class="hl com"># Crop</span>
<span class="hl std">cropRst</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">crop</span><span class="hl std">(rst, newExtent)</span>

<span class="hl kwd">print</span><span class="hl std">(cropRst)</span>
</pre></div>
<div class="output"><pre class="knitr r">## class       : RasterLayer 
## dimensions  : 455, 430, 195650  (nrow, ncol, ncell)
## resolution  : 80, 80  (x, y)
## extent      : 554579.7, 588979.7, 4618337, 4654737  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=utm +zone=29 +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0 
## data source : in memory
## names       : srtm_pnpg 
## values      : 47, 1520  (min, max)
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">####################</span>
<span class="hl com">#                  #</span>
<span class="hl com">#    Exercise 10   #</span>
<span class="hl com">#                  #</span>
<span class="hl com">####################</span>

<span class="hl com"># Target CRS</span>
<span class="hl std">targetCRS</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">CRS</span><span class="hl std">(</span><span class="hl str">&quot;+init=epsg:3035&quot;</span><span class="hl std">)</span>

<span class="hl com"># Reproject data</span>
<span class="hl std">rst_ETRS89_LAEA</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">projectRaster</span><span class="hl std">(rst,</span> <span class="hl kwc">crs</span> <span class="hl std">= targetCRS,</span> <span class="hl kwc">res</span> <span class="hl std">=</span> <span class="hl num">100</span><span class="hl std">,</span> <span class="hl kwc">method</span> <span class="hl std">=</span> <span class="hl str">'bilinear'</span><span class="hl std">)</span>

<span class="hl kwd">print</span><span class="hl std">(rst_ETRS89_LAEA)</span>
</pre></div>
<div class="output"><pre class="knitr r">## class       : RasterLayer 
## dimensions  : 572, 547, 312884  (nrow, ncol, ncell)
## resolution  : 100, 100  (x, y)
## extent      : 2799171, 2853871, 2238356, 2295556  (xmin, xmax, ymin, ymax)
## coord. ref. : +init=epsg:3035 +proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs 
## data source : in memory
## names       : srtm_pnpg 
## values      : 10.25648, 1515.846  (min, max)
</pre></div>
</div></div>
